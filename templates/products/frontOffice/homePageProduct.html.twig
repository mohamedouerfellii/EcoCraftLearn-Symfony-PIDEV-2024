{% extends 'baseFront.html.twig' %}
{% block body %}
 <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <!-- Overlay Start -->
        <div class="overlay"></div>
        <!-- Overlay End -->

        <!-- Slider Start -->
        <div class="section slider-section">

            <!-- Slider Shape Start -->
            <div class="slider-shape">
                <img class="shape-1 animation-round" src="{{asset('assets/images/shape/shape-8.png')}}" alt="Shape">
            </div>
            <!-- Slider Shape End -->

            <div class="container">

                <!-- Slider Content Start -->
                <div class="slider-content">
                    <h4 class="sub-title">Start your favourite course</h4>
                    <h2 class="main-title">Now learning from anywhere, and build your <span>bright career.</span></h2>
                    <p>It has survived not only five centuries but also the leap into electronic typesetting.</p>
                    <a class="btn btn-primary btn-hover-dark" href="{{ path('MyProduct')}}">My Products</a>
                </div>
                <!-- Slider Content End -->

            </div>

            <!-- Slider Courses Box Start -->
            <div class="slider-courses-box">

                <img class="shape-1 animation-left" src="{{asset('assets/images/shape/shape-5.png')}}" alt="Shape">

                <div class="box-content">
                    <div class="box-wrapper">
                        <i class="flaticon-open-book"></i>
                        <span class="count">1,235</span>
                        <p>courses</p>
                    </div>
                </div>

                <img class="shape-2" src="{{asset('assets/images/shape/shape-6.png')}}" alt="Shape">

            </div>
            <!-- Slider Courses Box End -->

            <!-- Slider Rating Box Start -->
            <div class="slider-rating-box">

                <div class="box-rating">
                    <div class="box-wrapper">
                        <span class="count">4.8 
                        
                        <i class="flaticon-star"></i>
                        
                        </span>
                        <p>Rating (86K)</p>
                    </div>
                </div>

                <img class="shape animation-up" src="{{asset('assets/images/shape/shape-7.png')}}" alt="Shape">

            </div>
            <!-- Slider Rating Box End -->

            <!-- Slider Images Start -->
            <div class="slider-images">
                <div class="images">
                    <img src="{{asset('assets/images/slider/slider-1.png')}}" alt="Slider">
                </div>
            </div>
            <!-- Slider Images End -->

            <!-- Slider Video Start -->
            <div class="slider-video">
                <img class="shape-1" src="{{asset('assets/images/shape/shape-9.png')}}" alt="Shape">

                <div class="video-play">
                    <img src="{{asset('assets/images/shape/shape-10.png')}}" alt="Shape">
                    <a href="https://www.youtube.com/watch?v=BRvyWfuxGuU" class="play video-popup"><i class="flaticon-play"></i></a>
                </div>
            </div>
            <!-- Slider Video End -->

        </div>
        <!-- Slider End -->

        <!-- All Courses Start -->
        <div class="section section-padding-02">
        
                {% for label, messages in app.flashes %}
                {% for message in messages %}
                    <div class="alert alert-danger" style="color: #721c24; background-color: #f8d7da; border-color: #f5c6cb; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);">
                        {{ message }}
                    </div>
                    <script>
                        setTimeout(function() {
                            document.querySelector('.alert').style.display = 'none';
                        }, 3000); 
                    </script>
                {% endfor %}
            {% endfor %}
         {% block bodyProductQuantity %}
            <div class="container">





                <!-- All Courses Top Start -->
                <div class="courses-top">
                 {# Check if there's an error flash message #}
               
                    <!-- Section Title Start -->
                    <div class="section-title shape-01">
                        <h2 class="main-title">All <span>Products</span> of EcoCraftLearning</h2>
                    </div>
                    <!-- Section Title End -->


                 


       
<div class="courses-search">
    <form id="course-search-form">
     <input type="text" id="search-input" onkeyup="searchProduct(this.value)" data-url="{{ path('rechercher_produit') }}" placeholder="Search here">
        <button type="submit"><i class="flaticon-magnifying-glass"></i></button>
    </form>
</div>



<script>
    $(document).ready(function() {
        $('#course-search-form').submit(function(event) {
            event.preventDefault(); 

            var query = $('#search-input').val(); 

            
            rechercherProduit(query);
        });
    });

   
    function rechercherProduit(query) {
        $.ajax({
            url: '/rechercher-produit',
            type: 'GET',
            data: { query: query },
            success: function(response) {
                if (response.success) {
                    afficherResultats(response.products);
                } else {
                    console.error("Erreur lors de la recherche de produits :", response.message);
                }
            },
            error: function(xhr, status, error) {
                console.error("Erreur lors de la requête AJAX :", error);
            }
        });
    }

   
    function afficherResultats(products) {
        var resultsDiv = $('#search-results');
        resultsDiv.empty();
        if (products.length > 0) {
            products.forEach(function(product) {
           
                var productDiv = $('<div>');

        
                productDiv.append('<p><strong>Nom :</strong> ' + product.name + '</p>');
                productDiv.append('<p><strong>Description :</strong> ' + product.description + '</p>');
                productDiv.append('<p><strong>Prix :</strong> ' + product.price + '</p>');
                productDiv.append('<p><strong>Quantité :</strong> ' + product.quantite + '</p>');
                productDiv.append('<p><strong>Date :</strong> ' + product.adddate + '</p>');

         
                resultsDiv.append(productDiv);
            });
        } else {
            resultsDiv.text("Aucun résultat trouvé.");
        }
    }
</script>



                    <!-- Courses Search End -->

                </div>

                    <style>
        .badge {
            background-color: #dc3545;
            color: white;
            border-radius: 10px;
            padding: 5px 10px;
            position: absolute;
            top: 0;
            right: 0;
            transform: translate(40%, -40%);
        }
    </style>

<div class="courses-btn text-center" style="width: 2000px; height: 50px; position: relative;">
    <a href="{{ path('my_cart') }}" id="myCartBtn" class="btn btn-secondary btn-hover-primary">My Carts <span class="badge badge-danger">Loading...</span></a>
    <a href="{{ path('My_Order') }}" id="myOrderBtn" class="btn btn-secondary btn-hover-primary">My Orders <span class="badge badge-danger">Loading...</span></a>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        fetch('{{ path('cart_and_orders_count') }}')
            .then(response => response.json())
            .then(data => {
                document.getElementById('myCartBtn').querySelector('span.badge').textContent = data.souscartCount;
                document.getElementById('myOrderBtn').querySelector('span.badge').textContent = data.orderCount;
            })
            .catch(error => console.error('Error fetching cart and orders count:', error));
    });
     </script>



                   
                <!-- All Courses Top End -->
                <!-- All Courses tab content Start -->
               
                <div class="tab-content courses-tab-content">
               

                    <div class="tab-pane fade show active" id="tabs1">
                    
                        <!-- All Courses Wrapper Start -->
                        <div class="courses-wrapper">
                         
                           <div class="row">
                            {% for p in Products %}
                           <div class="col-lg-4 col-md-6">
                          <!-- Single Courses Start -->
                              <div class="single-courses">
                         <div class="courses-images">

                         <a href="{{ path('addevaluationproduct', { 'idproduct': p.idproduct }) }}">

                        <img src="{{ asset('contents/uploads/products/' ~ p.image) }}" alt="Courses" style="width:330px;height:300px;"  ></a>
                       </div>
                      <div class="courses-content">
                    <h4 class="title"><a href="#">{{ p.name }}</a></h4>
                    <div class="courses-meta">
                        <span><i class=""></i>Quantity : {{ p.quantite }}</span>
                    </div>

                              <div class="courses-author">
                        <div class="author">
                            <div class="author-name"></div>
                        </div>
                        <div class="tag">
                            <a href="{{ path('buy_now', {'idproduct': p.idproduct}) }}">Buy Now</a>
                        </div>                        
                    </div>
                    <div class="courses-price-review">
                        <div class="courses-price">
                            <span class="sale-parice">{{ p.price }} DT</span>
                        </div>
                        <div class="courses-review">
                            <span class="rating-count">4.9</span>
                            <span class="rating-star">
                                <span class="rating-bar" style="width: 80%;"></span>
                            </span>
                            </div>
                            </div>
                   
          
                            </div>
                        </div>
                           <!-- Single Courses End -->
                      </div>
                        {% endfor %}
                      </div>

                              
                            </div>
                           
                            </div>
 
                        </div>
                       
                        <!-- All Courses Wrapper End -->
                    </div>
                       <br>
                  <br> 
                </div>
                <!-- All Courses tab content End -->
               

                <!-- All Courses BUtton Start -->
         

                  <br>
                  <br> 
                <!-- All Courses BUtton End -->
            </div>
             {% endblock %}
        </div>   
        <!-- All Courses End -->       


{% endblock %}